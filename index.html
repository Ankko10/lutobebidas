<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luto Bebidas - Distribuidora</title>
    <style>
        /* --- ESTILOS TEMA DARK LUXURY --- */
        :root {
            --accent-color: #ffffff;
            --dark-bg-main: #121212; 
            --dark-bg-secondary: #1e1e1e;
            --card-bg: #ffffff;
            --text-main: #f0f0f0;
            --text-dark: #111111;
            --border-dark: #333;
            --promo-red: #d32f2f;
        }
        
        body { 
            font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0;
            color: var(--text-main);
            overflow-x: hidden;
            background: linear-gradient(to bottom, #2c2c2c 0%, #000000 100%);
            min-height: 100vh;
        }

        /* ANIMACIONES */
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceCart { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        @keyframes scrollBanner { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* PORTADA */
        #landing-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--dark-bg-main); 
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
            transition: opacity 0.5s ease;
        }
        .landing-logo { max-width: 300px; width: 80%; height: auto; margin-bottom: 40px; animation: fadeInDown 1.5s ease; }
        .enter-btn {
            background-color: var(--accent-color); color: var(--dark-bg-main);
            padding: 15px 50px; font-size: 1.2rem; border: none; border-radius: 50px; 
            cursor: pointer; text-transform: uppercase; font-weight: bold; 
            box-shadow: 0 0 20px rgba(255,255,255,0.1); transition: transform 0.2s;
            animation: fadeInUp 1.5s ease 0.5s backwards;
        }
        .enter-btn:hover { transform: scale(1.05); background-color: #ddd; }
        
        /* HEADER */
        header {
            background-color: var(--dark-bg-secondary); padding: 0.8rem 1.5rem; display: none;
            justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.5); border-bottom: 1px solid var(--border-dark);
            animation: fadeInDown 0.5s ease;
        }
        .logo-container img { height: 45px; width: auto; cursor: pointer; transition: transform 0.2s; }
        .logo-container img:hover { transform: scale(1.05); }

        .cart-icon-btn {
            background: var(--accent-color); color: var(--dark-bg-main); 
            border: none; padding: 8px 18px; border-radius: 30px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 8px; font-size: 0.9rem;
            transition: transform 0.2s;
        }
        .cart-icon-btn:hover { transform: scale(1.05); background-color: #ddd; }
        .cart-bounce { animation: bounceCart 0.6s; }

        /* --- TIENDA --- */
        #shop-view { display: none; max-width: 1200px; margin: 20px auto; padding: 0 20px 50px 20px; }
        
        .categories-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 20px; scrollbar-width: none; }
        .categories-container::-webkit-scrollbar { display: none; }
        
        .filter-btn { 
            background: rgba(255,255,255,0.1); border: 1px solid var(--border-dark); color: var(--text-main);
            padding: 8px 20px; border-radius: 20px; cursor: pointer; white-space: nowrap; transition: 0.3s;
        }
        .filter-btn.active, .filter-btn:hover { background: var(--accent-color); color: var(--dark-bg-main); transform: translateY(-2px); }
        .filter-btn.promo-btn { background-color: var(--promo-red); border-color: var(--promo-red); font-weight: bold; }
        .filter-btn.promo-btn.active, .filter-btn.promo-btn:hover { background-color: #ff5252; color: white; transform: translateY(-2px) scale(1.05); box-shadow: 0 5px 15px rgba(211, 47, 47, 0.4); }

        .banner-wrapper { width: 100%; overflow: hidden; margin-bottom: 30px; position: relative; border-bottom: 1px solid var(--border-dark); padding-bottom: 20px; animation: fadeInDown 0.8s ease backwards; }
        .banner-track { display: flex; gap: 20px; width: max-content; animation: scrollBanner 30s linear infinite; }
        .banner-track:hover { animation-play-state: paused; }
        
        .banner-card { min-width: 160px; background: var(--card-bg); color: var(--text-dark); border: none; border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .banner-card:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(255,255,255,0.1); }
        .banner-card img { width: 70px; height: 70px; object-fit: contain; }

        .category-section { margin-bottom: 40px; animation: fadeInUp 0.8s ease backwards; }
        .category-title { font-size: 1.4rem; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid var(--accent-color); text-transform: capitalize; }
        .category-title.promo-title { border-left-color: var(--promo-red); color: var(--promo-red); font-weight: bold; font-size: 1.6rem; }

        .horizontal-scroll-row { display: flex; gap: 20px; overflow-x: auto; padding: 10px 5px 20px 5px; scroll-behavior: smooth; scrollbar-width: thin; }
        .horizontal-scroll-row::-webkit-scrollbar { height: 8px; }
        .horizontal-scroll-row::-webkit-scrollbar-track { background: #111; }
        .horizontal-scroll-row::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        .product-card { 
            background: var(--card-bg); color: var(--text-dark);
            min-width: 200px; width: 200px;
            padding: 15px; border-radius: 12px; text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            transition: 0.3s;
            animation: fadeInUp 0.6s ease backwards; 
        }
        .product-card:nth-child(odd) { animation-delay: 0.1s; }
        .product-card:nth-child(even) { animation-delay: 0.2s; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 20px 50px rgba(255,255,255,0.15); }
        .product-img { width: 100%; height: 160px; object-fit: contain; margin-bottom: 10px; transition: transform 0.3s; }
        .product-card:hover .product-img { transform: scale(1.05); }
        .product-title { font-weight: 600; margin-bottom: 5px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1rem;}
        .product-price { font-size: 1.2rem; font-weight: 800; color: #000; display: block; margin: 10px 0; }
        .add-btn { width: 100%; padding: 10px; background: #000; color: #fff; border: none; font-weight: bold; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .add-btn:hover { background: #333; }
        .add-btn:active { transform: scale(0.95); }

        /* CARRITO */
        #cart-view { 
            display: none; max-width: 800px; margin: 30px auto; padding: 0 20px; 
            background: var(--dark-bg-secondary); border: 1px solid var(--border-dark);
            border-radius: 15px; min-height: 60vh; box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
            animation: fadeInUp 0.5s ease;
        }
        .cart-title { font-size: 1.5rem; border-bottom: 2px solid var(--border-dark); padding: 20px 0; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px dashed var(--border-dark); transition: background-color 0.2s; }
        .cart-item-row:hover { background-color: rgba(255,255,255,0.05); }
        .item-thumb { width: 50px; height: 50px; object-fit: contain; border-radius: 5px; background: white;}
        .qty-btn { border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 1.2rem; padding: 0 10px; color: var(--accent-color); transition: transform 0.2s;}
        .qty-btn:active { transform: scale(1.2); }
        .whatsapp-btn { background-color: #25D366; color: white; width: 100%; padding: 18px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .whatsapp-btn:hover { background-color: #128C7E; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); }

        /* CARGA */
        #loader { text-align:center; padding: 20px; color: #fff; font-size: 1.2rem; display:none; }

        footer { text-align: center; padding: 20px; margin-top: 50px; border-top: 1px solid var(--border-dark); color: #555; font-size: 0.8rem; }
    </style>
</head>
<body>

<div id="landing-view">
    <img src="logo-luto.png" alt="Luto Bebidas" class="landing-logo" onerror="this.style.display='none'; document.querySelector('.enter-btn').innerHTML='Ingresar al Cat√°logo'">
    <button class="enter-btn" onclick="enterSite()">Ingresar al Cat√°logo</button>
</div>

<header id="main-header">
    <div class="logo-container" onclick="goHome()">
        <img src="logo-luto.png" alt="Luto" onerror="this.src='https://via.placeholder.com/100?text=LUTO'">
    </div>
    <button class="cart-icon-btn" id="cartBtn" onclick="showCart()">
        üõí Ver Carrito (<span id="header-count">0</span>)
    </button>
</header>

<div id="shop-view">
    <div class="categories-container">
        <button class="filter-btn promo-btn" onclick="renderShop('promociones-navidenas')">üéÑ Promos Navide√±as</button>
        <button class="filter-btn active" onclick="renderShop('todos')">Todos</button>
        <button class="filter-btn" onclick="renderShop('fernet')">Fernet</button>
        <button class="filter-btn" onclick="renderShop('vodka')">Vodka</button>
        <button class="filter-btn" onclick="renderShop('sin-alcohol')">Gaseosas</button>
        <button class="filter-btn" onclick="renderShop('cervezas')">Cervezas</button>
        <button class="filter-btn" onclick="renderShop('vinos')">Vinos</button>
    </div>

    <div class="banner-wrapper">
        <div class="banner-track" id="banner-track"></div>
    </div>

    <div id="loader">Cargando productos actualizados...</div>
    <div id="products-container"></div>
</div>

<div id="cart-view">
    <div class="cart-title">
        <span>Tu Pedido</span>
        <button style="border:none; background:transparent; text-decoration:underline; cursor:pointer; color:#fff;" onclick="goHome()">‚Üê Volver</button>
    </div>
    <div id="cart-list-container"></div>
    <div style="text-align:right; margin-top:30px;">
        Total: <span style="font-size:2rem; font-weight:bold;">$<span id="final-total">0</span></span>
    </div>
    <button class="whatsapp-btn" onclick="sendOrder()">CONFIRMAR PEDIDO</button>
</div>

<footer>
    <p>&copy; 2024 Luto Bebidas - Todos los derechos reservados</p>
</footer>

<script>
    const phoneNumber = "5493425406314"; 
    
    // =========================================================
    // PEGA AQU√ç TU LINK DE GOOGLE SHEETS (PUBLISH TO WEB > CSV)
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRW35MqJNAOMlhb0NFavQp8E4rUNs3EepxMVl6m5MUunOo5xqySFnnlfIq_JsYJ3re0HCUOfFkygWDf/pubhtml"; 
    // =========================================================

    let products = []; // Se llenar√° desde la hoja de c√°lculo
    let cart = [];
    let headerCount, cartBtn, productsContainer;

    async function loadProducts() {
        const loader = document.getElementById('loader');
        if(loader) loader.style.display = 'block';

        try {
            if (sheetUrl === "PEGA_AQUI_TU_LINK_DE_GOOGLE_SHEETS" || sheetUrl === "") {
                console.warn("Falta el link de la hoja de c√°lculo. Usando modo demo vac√≠o.");
                // Si no hay link, no carga nada o podr√≠as dejar productos por defecto aqu√≠.
                if(loader) loader.innerText = "Error: Faltar vincular Google Sheets en el c√≥digo.";
                return;
            }

            const response = await fetch(sheetUrl);
            const data = await response.text();
            
            // Convertir CSV a JSON
            const rows = data.split('\n').slice(1); // Quitar cabecera
            products = rows.map(row => {
                const cols = row.split(',');
                if(cols.length < 4) return null; // Fila inv√°lida
                
                // Limpieza b√°sica de datos
                return {
                    id: parseInt(cols[0]),
                    name: cols[1]?.trim(),
                    category: cols[2]?.trim(),
                    price: parseInt(cols[3]) || 0,
                    img: cols[4]?.trim() || '',
                    hidden: cols[5]?.trim().toUpperCase() === 'TRUE'
                };
            }).filter(p => p !== null); // Eliminar nulos

            // Iniciar la tienda
            if(loader) loader.style.display = 'none';
            renderBanner();
            renderShop('todos');

        } catch (error) {
            console.error("Error cargando productos:", error);
            if(loader) loader.innerText = "Error al cargar precios. Verifique conexi√≥n.";
        }
    }


    function enterSite() {
        const landing = document.getElementById('landing-view');
        landing.style.opacity = '0';
        setTimeout(() => {
            landing.style.display = 'none';
            document.getElementById('main-header').style.display = 'flex';
            document.getElementById('shop-view').style.display = 'block';
            loadProducts(); // Cargar productos al entrar
        }, 500);
    }
    
    function showCart() {
        document.getElementById('shop-view').style.display = 'none';
        document.getElementById('cart-view').style.display = 'block';
        renderCartDetail(); 
        window.scrollTo(0,0);
    }
    
    function goHome() {
        document.getElementById('cart-view').style.display = 'none';
        document.getElementById('shop-view').style.display = 'block';
        window.scrollTo(0,0);
    }

    function renderBanner() {
        const track = document.getElementById('banner-track');
        if(!track) return;
        track.innerHTML = '';
        
        // Solo mostrar productos no ocultos
        const visible = products.filter(p => !p.hidden);
        // Tomar algunos para el banner (los primeros 15 disponibles)
        const featured = [...visible.slice(0, 15), ...visible.slice(0, 15)]; 

        featured.forEach(p => {
            let priceDisplay = p.price === 0 ? "Consultar" : `$${p.price}`;
            const card = document.createElement('div');
            card.className = 'banner-card';
            card.onclick = () => addToCart(p.id);
            card.innerHTML = `
                <img src="${p.img}" onerror="this.src='https://via.placeholder.com/80?text=Luto'">
                <div style="font-weight:bold; font-size:0.9rem; margin-top:5px;">${p.name}</div>
                <div style="color:#333; font-weight:bold; font-size:0.9rem;">${priceDisplay}</div>
            `;
            track.appendChild(card);
        });
    }

    function renderShop(filter = 'todos') {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        const btns = document.querySelectorAll('.filter-btn');
        btns.forEach(b => { 
            if(b.getAttribute('onclick').includes(`'${filter}'`)) b.classList.add('active'); 
        });

        if(!productsContainer) productsContainer = document.getElementById('products-container');
        if(!productsContainer) return;
        productsContainer.innerHTML = '';

        if(products.length === 0) return; // Si no cargaron, no renderizar

        let categoriesToShow = [];
        if (filter === 'todos') {
            let allCats = [...new Set(products.map(p => p.category))];
            if(allCats.includes('promociones-navidenas')) {
                allCats = allCats.filter(c => c !== 'promociones-navidenas');
                allCats.unshift('promociones-navidenas');
            }
            categoriesToShow = allCats;
        } else {
            categoriesToShow = [filter];
        }

        categoriesToShow.forEach(cat => {
            // Filtrar y NO mostrar ocultos
            const productsInCat = products.filter(p => p.category === cat && !p.hidden);
            
            if(productsInCat.length > 0) {
                let displayTitle = cat.replace('-', ' ').toUpperCase(); 
                let extraClass = "";
                if(cat === 'sin-alcohol') displayTitle = "GASEOSAS Y AGUAS";
                if(cat === 'promociones-navidenas') {
                    displayTitle = "üéÑ PROMOCIONES NAVIDE√ëAS üéÑ";
                    extraClass = "promo-title";
                }

                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<div class="category-title ${extraClass}">${displayTitle}</div>`;

                const row = document.createElement('div');
                row.className = 'horizontal-scroll-row';

                productsInCat.forEach(p => {
                    let priceDisplay = p.price === 0 ? "Consultar" : `$${p.price}`;
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <img src="${p.img}" alt="${p.name}" class="product-img" onerror="this.src='https://via.placeholder.com/150?text=Sin+Imagen'">
                        <div style="color:#777; font-size:0.8rem; text-transform:uppercase;">
                            ${p.category.replace('promociones-navidenas', 'Navidad')}
                        </div>
                        <div class="product-title">${p.name}</div>
                        <div class="product-price">${priceDisplay}</div>
                        <button class="add-btn" onclick="addToCart(${p.id})">AGREGAR</button>
                    `;
                    row.appendChild(card);
                });

                section.appendChild(row);
                productsContainer.appendChild(section);
            }
        });
    }

    function addToCart(id) {
        const product = products.find(p => p.id === id);
        const item = cart.find(i => i.id === id);
        if (item) item.qty++; else cart.push({ ...product, qty: 1 });
        updateHeaderCount();
        if(cartBtn) {
            cartBtn.classList.add('cart-bounce');
            setTimeout(() => { cartBtn.classList.remove('cart-bounce'); }, 600);
        }
    }

    function updateHeaderCount() {
        if(!headerCount) headerCount = document.getElementById('header-count');
        if(headerCount) headerCount.innerText = cart.reduce((sum, item) => sum + item.qty, 0);
    }

    function renderCartDetail() {
        const container = document.getElementById('cart-list-container');
        const totalElem = document.getElementById('final-total');
        if(!container) return;

        container.innerHTML = '';
        let total = 0;
        if(cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#ccc; margin-top:50px;">Carrito vac√≠o</p>';
            if(totalElem) totalElem.innerText = "0"; return;
        }
        cart.forEach((item, index) => {
            total += item.price * item.qty;
            container.innerHTML += `
                <div class="cart-item-row">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <img src="${item.img}" class="item-thumb" onerror="this.src='https://via.placeholder.com/50'">
                        <div><div style="font-weight:bold;">${item.name}</div><div style="font-size:0.9rem; color:#bbb;">$${item.price} c/u</div></div>
                    </div>
                    <div style="white-space:nowrap;">
                        <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
                        ${item.qty}
                        <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
                    </div>
                    <div style="font-weight:bold; min-width:60px; text-align:right;">$${item.price * item.qty}</div>
                </div>
            `;
        });
        if(totalElem) totalElem.innerText = total;
    }

    function changeQty(index, delta) {
        cart[index].qty += delta;
        if(cart[index].qty <= 0) cart.splice(index, 1);
        updateHeaderCount();
        renderCartDetail();
    }

    function sendOrder() {
        if(cart.length === 0) return;
        let msg = "Hola *Luto Bebidas*, quiero confirmar mi pedido:%0A%0A";
        let total = 0;
        cart.forEach(i => { msg += `- ${i.name} (x${i.qty}): $${i.price*i.qty}%0A`; total += i.price*i.qty; });
        msg += `%0A*TOTAL FINAL: $${total}*`;
        msg += "%0A%0AQuedo a la espera de confirmaci√≥n.";
        window.open(`https://wa.me/${phoneNumber}?text=${msg}`, '_blank');
    }

    document.addEventListener("DOMContentLoaded", () => {
        headerCount = document.getElementById('header-count');
        cartBtn = document.getElementById('cartBtn');
        productsContainer = document.getElementById('products-container');
        // loadProducts se llama al entrar al sitio
    });
</script>

</body>
</html>